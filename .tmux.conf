# Mouse & history
set -g mouse on
set -g history-limit 100000   # was 10000

# Make ESC instant
set -s escape-time 0

# Keep manual window names
set -g allow-rename off

# Prefix to C-a
unbind C-b
set -g prefix C-a
bind C-a send-prefix
set -g repeat-time 0

# Pane navigation (hjkl)
unbind h; bind h select-pane -L
unbind j; bind j select-pane -D
unbind k; bind k select-pane -U
unbind l; bind l select-pane -R

# Rotate panes
bind r swap-pane -t :.+
bind R swap-pane -t :.-

# Split/new windows in cwd
bind '"' split-window -c "#{pane_current_path}"
bind %   split-window -h -c "#{pane_current_path}"
bind c   new-window     -c "#{pane_current_path}"

# Vi in copy-mode
setw -g mode-keys vi

# TERM/terminfo: better colors & TUI behavior
set -g default-terminal "tmux-256color"   # was screen-256color
# Keep alt-screen apps (Claude Code, full-screen TUIs) from nuking history
set -as terminal-overrides ',*:smcup@:rmcup@'

# Shell
set -g default-shell /bin/zsh

# Clipboard: tmuxâ†’system
set -g set-clipboard on
bind -T copy-mode-vi v send-keys -X begin-selection
unbind -T copy-mode-vi y
bind   -T copy-mode-vi y send-keys -X copy-pipe "pbcopy"
bind   -T copy-mode-vi Y send-keys -X copy-pipe "tr -d '\n' | sed 's/  *//g' | pbcopy"
bind -T copy-mode-vi Enter send-keys -X copy-selection-no-clear
unbind -T copy-mode-vi MouseDragEnd1Pane
bind   -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe "pbcopy"

# Smooth mouse wheel: enter copy-mode only when needed (no auto-exit jump)
unbind -n WheelUpPane
bind   -n WheelUpPane if -F "#{mouse_any_flag}" "send-keys -M" "copy-mode"
unbind -n WheelDownPane
bind   -n WheelDownPane if -F "#{mouse_any_flag}" "send-keys -M" "send-keys -M"

# Help editors & TUIs notice focus changes
set -g focus-events on

# Highlight active pane (reliable pane-based styling only)
# Note: client-focus-in/out hooks don't work reliably with iTerm focus events
# because they fire on tmux client attach/detach, not on terminal focus changes.
# iTerm sends focus events (\e[I/\e[O) which tmux passes through to apps,
# but tmux itself has no hook that fires on these events.
set -g window-style 'fg=#808080,bg=#3a3a3a'           # Inactive panes: dimmed text + lighter bg
set -g window-active-style 'fg=#ebdbb2,bg=terminal'   # Active pane: normal colors
set -g pane-border-style 'fg=#504945,bg=#504945'
set -g pane-active-border-style 'fg=#d79921,bg=#d79921'
